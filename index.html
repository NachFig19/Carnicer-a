<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pedido - La Guadalupana</title>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather&family=Playfair+Display:wght@600&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/4f3ce16e3e.js" crossorigin="anonymous"></script>
  <style>
    :root {
      --rojo: #8B0000;
      --crema: #fdf6ee;
      --gris-claro: #f0f0f0;
      --gris-texto: #555;
    }
    body {
      margin: 0;
      font-family: 'Merriweather', serif;
      background-color: var(--crema);
      color: var(--gris-texto);
    }
    header {
      background-color: var(--rojo);
      color: white;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
    }
    header img {
      height: 80px;
      margin-bottom: 0.5rem;
    }
    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      margin: 0;
    }
    form {
      max-width: 700px;
      margin: 2rem auto;
      padding: 2rem;
      background-color: white;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .section-title {
      font-size: 1.3rem;
      margin-bottom: 1rem;
      font-weight: bold;
    }
    .radio-group {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .radio-group input[type="radio"] {
      display: none;
    }
    .radio-group label {
      padding: 1rem;
      border: 2px solid var(--gris-claro);
      border-radius: 0.75rem;
      cursor: pointer;
      flex: 1;
      text-align: center;
      transition: all 0.3s ease;
      font-weight: bold;
      background-color: #fff;
    }
    .radio-group input[type="radio"]:checked + label {
      border-color: var(--rojo);
      background-color: #fff5f5;
      color: var(--rojo);
    }
    label i {
      display: block;
      font-size: 1.5rem;
      margin-bottom: 0.3rem;
    }
    .form-group {
      margin-bottom: 1.5rem;
    }
    label {
      display: block;
      margin-bottom: 0.3rem;
      font-weight: bold;
    }
    input, textarea {
      width: 100%;
      padding: 0.7rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    .hidden {
      display: none;
    }
    .error {
      color: red;
      font-size: 0.9rem;
      margin-top: 0.3rem;
    }
    @media (max-width: 600px) {
      .radio-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <img src="https://github.com/NachFig19/Practica/blob/7f346f5394976bd08edd3633bff36d5478df6f88/Imagen%20Pr%C3%A1ctica.png?raw=true" alt="Logo de La Guadalupana">
    <h1>Formulario de Pedido - La Guadalupana</h1>
  </header>

  <form id="pedidoForm" novalidate>
    <div class="section-title">Medio de Entrega</div>
    <div class="radio-group">
      <input type="radio" id="mostrador" name="entrega" value="mostrador" checked>
      <label for="mostrador"><i class="fas fa-store"></i>En Mostrador</label>
      <input type="radio" id="domicilio" name="entrega" value="domicilio">
      <label for="domicilio"><i class="fas fa-truck"></i>A Domicilio</label>
    </div>

    <div class="form-group">
      <label for="telefono">Número de Teléfono</label>
      <input type="tel" id="telefono" name="telefono" maxlength="10" placeholder="Ej. 2221234567" required pattern="\d{10}">
      <div class="error" id="errorTelefono"></div>
    </div>

    <div class="form-group hidden" id="grupoDomicilio">
      <label for="domicilioCompleto">Domicilio Completo</label>
      <input type="text" id="domicilioCompleto" name="domicilio">
    </div>

    <div class="form-group hidden" id="grupoReferencias">
      <label for="referencias">Referencias del Domicilio</label>
      <textarea id="referencias" name="referencias"></textarea>
    </div>

    <div class="form-group hidden" id="grupoNombre">
      <label for="nombreRecoger">Nombre para Recoger</label>
      <input type="text" id="nombreRecoger" name="nombre">
    </div>

    <button type="submit">Continuar</button>
  </form>

  <script>
    const form = document.getElementById('pedidoForm');
    const entregaRadios = document.querySelectorAll('input[name="entrega"]');
    const grupoDomicilio = document.getElementById('grupoDomicilio');
    const grupoReferencias = document.getElementById('grupoReferencias');
    const grupoNombre = document.getElementById('grupoNombre');
    const telefonoInput = document.getElementById('telefono');
    const errorTelefono = document.getElementById('errorTelefono');

    function actualizarCamposEntrega() {
      const seleccion = document.querySelector('input[name="entrega"]:checked').value;

      if (seleccion === 'domicilio') {
        grupoDomicilio.classList.remove('hidden');
        grupoReferencias.classList.remove('hidden');
        grupoNombre.classList.add('hidden');

        document.getElementById('domicilioCompleto').setAttribute('required', 'true');
        document.getElementById('referencias').setAttribute('required', 'true');
        document.getElementById('nombreRecoger').removeAttribute('required');
      } else {
        grupoDomicilio.classList.add('hidden');
        grupoReferencias.classList.add('hidden');
        grupoNombre.classList.remove('hidden');

        document.getElementById('domicilioCompleto').removeAttribute('required');
        document.getElementById('referencias').removeAttribute('required');
      }
    }

    entregaRadios.forEach(radio => {
      radio.addEventListener('change', actualizarCamposEntrega);
    });

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      let telefonoValido = /^\d{10}$/.test(telefonoInput.value.trim());

      if (!telefonoValido) {
        errorTelefono.textContent = 'El número debe contener exactamente 10 dígitos numéricos.';
        telefonoInput.focus();
        return;
      } else {
        errorTelefono.textContent = '';
      }

      // Si llegamos aquí, validación pasó
      alert('Formulario válido. Aquí continúa el flujo.');
    });

    // Inicialización
    actualizarCamposEntrega();
  </script>
  <!-- ... lo anterior permanece igual -->

<form id="pedidoForm" novalidate>
  <!-- Sección: Medio de Entrega -->
  <!-- ... ya existente -->

  <!-- Sección: Datos según medio de entrega -->
  <!-- ... ya existente -->

  <!-- 🚩 NUEVA SECCIÓN: Productos -->
  <div class="section-title">Productos Cárnicos</div>

  <div class="form-group">
    <label for="tipoProducto">Tipo de Producto</label>
    <select id="tipoProducto" required>
      <option value="">Seleccione una opción</option>
      <option value="res">Carne de Res</option>
      <option value="cerdo">Carne de Cerdo</option>
      <option value="pollo">Pollo</option>
      <option value="embutidos">Embutidos</option>
    </select>
  </div>

  <div class="form-group">
    <label for="detalleProducto">Detalle (ej. Costilla, Pierna, Jamón)</label>
    <input type="text" id="detalleProducto" placeholder="Ej: Milanesa, Costilla, Chorizo..." required>
  </div>

  <div class="form-group">
    <label for="cantidadProducto">Cantidad o Peso (kg)</label>
    <input type="number" id="cantidadProducto" min="0.1" step="0.1" placeholder="Ej: 2.5" required>
  </div>

  <button type="button" onclick="agregarProducto()">Agregar al Pedido</button>

  <!-- Lista dinámica de productos -->
  <ul id="listaProductos" style="margin-top: 1rem; padding-left: 1.5rem;"></ul>

  <!-- ... resto del formulario continúa igual -->
  <!-- Nombre para recoger o Dirección según selección -->
  <!-- Teléfono, envío o mostrador -->

  <button type="submit">Continuar</button>
</form>

<script>
  // ... código anterior permanece

  const listaProductos = document.getElementById('listaProductos');
  let productos = [];

  function agregarProducto() {
    const tipo = document.getElementById('tipoProducto').value;
    const detalle = document.getElementById('detalleProducto').value.trim();
    const cantidad = parseFloat(document.getElementById('cantidadProducto').value.trim());

    if (!tipo || !detalle || isNaN(cantidad) || cantidad <= 0) {
      alert('Por favor, complete todos los campos del producto correctamente.');
      return;
    }

    const producto = { tipo, detalle, cantidad };
    productos.push(producto);
    renderizarProductos();

    // Limpiar campos
    document.getElementById('tipoProducto').value = '';
    document.getElementById('detalleProducto').value = '';
    document.getElementById('cantidadProducto').value = '';
  }

  function eliminarProducto(index) {
    productos.splice(index, 1);
    renderizarProductos();
  }

  function renderizarProductos() {
    listaProductos.innerHTML = '';
    productos.forEach((p, i) => {
      const item = document.createElement('li');
      item.innerHTML = `${p.tipo.toUpperCase()} - ${p.detalle} (${p.cantidad} kg) <button onclick="eliminarProducto(${i})" style="margin-left: 10px; color: red;">Eliminar</button>`;
      listaProductos.appendChild(item);
    });
  }
</script>
<!-- Modal de Confirmación -->
<div id="modalConfirmacion" class="modal">
  <div class="modal-content">
    <h2>¿Confirmar Pedido?</h2>
    <div id="resumenPedido" style="text-align: left; margin-bottom: 1rem;"></div>
    <button class="btn-secundario" onclick="cerrarModal()">Editar Pedido</button>
    <button class="btn-primario" onclick="confirmarPedido()">Confirmar Pedido</button>
  </div>
</div>
<script>
  const pedidoForm = document.getElementById('pedidoForm');
  const modal = document.getElementById('modalConfirmacion');
  const resumenPedido = document.getElementById('resumenPedido');

  pedidoForm.addEventListener('submit', function (e) {
    e.preventDefault();

    // Validación de teléfono
    const telefono = document.getElementById('telefono').value.trim();
    if (!/^\d{10}$/.test(telefono)) {
      alert('El número de teléfono debe contener exactamente 10 dígitos.');
      return;
    }

    if (productos.length === 0) {
      alert('Debe agregar al menos un producto al pedido.');
      return;
    }

    // Construir resumen del pedido
    const medioEntrega = document.querySelector('input[name="entrega"]:checked').value;
    const direccion = document.getElementById('direccion').value.trim();
    const referencias = document.getElementById('referencias').value.trim();
    const nombre = document.getElementById('nombreCliente').value.trim();

    let html = `<strong>Medio de Entrega:</strong> ${medioEntrega === 'domicilio' ? 'A Domicilio' : 'En Mostrador'}<br>`;
    html += `<strong>Teléfono:</strong> ${telefono}<br>`;
    if (medioEntrega === 'domicilio') {
      html += `<strong>Dirección:</strong> ${direccion}<br>`;
      html += `<strong>Referencias:</strong> ${referencias}<br>`;
    } else {
      html += `<strong>Nombre para recoger:</strong> ${nombre}<br>`;
    }

    html += `<strong>Productos:</strong><ul>`;
    productos.forEach(p => {
      html += `<li>${p.tipo.toUpperCase()} - ${p.detalle} (${p.cantidad} kg)</li>`;
    });
    html += `</ul>`;

    resumenPedido.innerHTML = html;
    modal.style.display = 'flex';
  });

  function cerrarModal() {
    modal.style.display = 'none';
  }

  function confirmarPedido() {
    modal.style.display = 'none';
    // Aquí iniciaremos la siguiente sección: productos complementarios
    mostrarProductosComplementarios();
  }

  function mostrarProductosComplementarios() {
    alert("Aquí iría la sección de productos complementarios. Lo implementamos enseguida.");
    // Pronto: sección visual con checkboxes para productos extra
  }
</script>
<!-- Sección Productos Complementarios -->
<section id="productosComplementarios" style="display: none; padding: 2rem;">
  <h2>Productos Complementarios</h2>
  <p>Puede seleccionar productos adicionales para complementar su pedido:</p>
  <div id="complementariosLista" class="complementarios-lista">
    <label><input type="checkbox" value="Salsa de chipotle"> Salsa de chipotle</label>
    <label><input type="checkbox" value="100 grs de chicharrón"> 100 grs de chicharrón</label>
    <label><input type="checkbox" value="100 grs de tocino"> 100 grs de tocino</label>
    <label><input type="checkbox" value="100 grs de jamón"> 100 grs de jamón de pavo/lomo</label>
    <label><input type="checkbox" value="100 grs de queso de puerco"> 100 grs de queso de puerco</label>
    <label><input type="checkbox" value="Tortillas de harina"> Tortillas de harina</label>
    <label><input type="checkbox" value="Tostadas de maíz"> Tostadas de maíz</label>
    <label><input type="checkbox" value="Totopos de maíz"> Totopos de maíz</label>
    <label><input type="checkbox" value="1 kg de maíz pozolero"> 1 kg de maíz pozolero</label>
    <label><input type="checkbox" value="Condimento para carnes"> Condimento para carnes</label>
  </div>
  <button class="btn-primario" onclick="confirmarPedidoFinal()">Confirmar Pedido Final</button>
</section>

<!-- Mensaje final -->
<section id="mensajeFinal" style="display: none; padding: 2rem;">
  <h2>¡Su pedido ha sido recibido con éxito!</h2>
  <p>Le contactaremos pronto para confirmar los detalles y la entrega.</p>
  <div id="infoFinalContacto"></div>
  <a id="btnDescargarPDF" class="btn-primario" style="margin-top: 1rem;" download>Descargar Comprobante PDF</a>
</section>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  let datosPedido = {};

  function mostrarProductosComplementarios() {
    document.getElementById('pedidoForm').style.display = 'none';
    document.getElementById('productosComplementarios').style.display = 'block';

    // Guardar datos esenciales del pedido
    datosPedido.telefono = document.getElementById('telefono').value.trim();
    datosPedido.nombreCliente = document.getElementById('nombreCliente').value.trim();
    datosPedido.entrega = document.querySelector('input[name="entrega"]:checked').value;
    datosPedido.direccion = document.getElementById('direccion').value.trim();
    datosPedido.referencias = document.getElementById('referencias').value.trim();
    datosPedido.productos = [...productos];
  }

  async function confirmarPedidoFinal() {
    const seleccionados = Array.from(document.querySelectorAll('#complementariosLista input:checked')).map(cb => cb.value);
    datosPedido.complementarios = seleccionados;

    document.getElementById('productosComplementarios').style.display = 'none';
    document.getElementById('mensajeFinal').style.display = 'block';

    const info = document.getElementById('infoFinalContacto');
    let html = `<strong>Medio:</strong> ${datosPedido.entrega === 'domicilio' ? 'A Domicilio' : 'En Mostrador'}<br>`;
    if (datosPedido.entrega === 'mostrador') {
      html += `<strong>Dirección para recoger:</strong> 9 sur 2709 A, Colonia Chulavista. Puebla, Puebla, México.<br>`;
    }
    html += `<strong>Teléfono Fijo:</strong> 2222438926<br><strong>WhatsApp:</strong> 2226857926<br>`;
    info.innerHTML = html;

    await generarPDF(datosPedido);
    reiniciarFormulario();
  }

  async function generarPDF(datos) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const folio = `${datos.nombreCliente.charAt(0).toUpperCase()}${datos.telefono.slice(-4)}${datos.entrega === 'domicilio' ? 'DOM' : 'MOS'}`;

    let y = 10;
    doc.setFontSize(12);
    doc.text(`Folio del Pedido: ${folio}`, 10, y); y += 10;
    doc.text(`Nombre del Cliente: ${datos.nombreCliente}`, 10, y); y += 10;
    doc.text(`Teléfono: ${datos.telefono}`, 10, y); y += 10;
    doc.text(`Medio de Entrega: ${datos.entrega === 'domicilio' ? 'A Domicilio' : 'En Mostrador'}`, 10, y); y += 10;
    if (datos.entrega === 'domicilio') {
      doc.text(`Dirección: ${datos.direccion}`, 10, y); y += 10;
      doc.text(`Referencias: ${datos.referencias}`, 10, y); y += 10;
    }

    doc.text("Productos:", 10, y); y += 10;
    datos.productos.forEach(p => {
      doc.text(`• ${p.tipo} - ${p.detalle} - ${p.cantidad} kg`, 15, y); y += 8;
    });

    if (datos.complementarios.length > 0) {
      doc.text("Complementarios:", 10, y); y += 10;
      datos.complementarios.forEach(c => {
        doc.text(`• ${c}`, 15, y); y += 8;
      });
    }

    const pdfBlob = doc.output("blob");
    const url = URL.createObjectURL(pdfBlob);
    const link = document.getElementById('btnDescargarPDF');
    link.href = url;
    link.download = `Pedido_LaGuadalupana_${folio}.pdf`;
  }

  function reiniciarFormulario() {
    productos.length = 0;
    document.getElementById('pedidoForm').reset();
    actualizarProductos();
    document.getElementById('pedidoForm').style.display = 'block';
    document.getElementById('productosComplementarios').style.display = 'none';
    setTimeout(() => {
      document.getElementById('mensajeFinal').style.display = 'none';
    }, 8000);
  }
</script>
</body>
</html>
